<% if @user == nil %>
    <% user = current_user %>
<% else %>
    <% user = @user %>
<% end %>

<% @moods = Mood.where(user_id: user.id) %>

<%
   if @mood_lookback_period == 'week'
     mood_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('this_week')).average(:mood_rating)
     anxiety_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('this_week')).average(:anxiety_rating)
     irritability_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('this_week')).average(:irritability_rating)
   elsif @mood_lookback_period == 'last_week'
     mood_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('last_week')).average(:mood_rating)
     anxiety_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('last_week')).average(:anxiety_rating)
     irritability_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('last_week')).average(:irritability_rating)
   elsif @mood_lookback_period == 'month'
     mood_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('this_month')).average(:mood_rating)
     anxiety_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('this_month')).average(:anxiety_rating)
     irritability_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('this_month')).average(:irritability_rating)
   elsif @mood_lookback_period == 'last_month'
     mood_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('last_month')).average(:mood_rating)
     anxiety_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('last_month')).average(:anxiety_rating)
     irritability_chart_data = @moods.group_by_day(:timestamp, range: date_range_for('last_month')).average(:irritability_rating)
   elsif @mood_lookback_period == 'year'
     mood_chart_data = @moods.group_by_month(:timestamp, range: date_range_for('this_year')).average(:mood_rating)
     anxiety_chart_data = @moods.group_by_month(:timestamp, range: date_range_for('this_year')).average(:anxiety_rating)
     irritability_chart_data = @moods.group_by_month(:timestamp, range: date_range_for('this_year')).average(:irritability_rating)
   elsif @mood_lookback_period == 'last_year'
     mood_chart_data = @moods.group_by_month(:timestamp, range: date_range_for('last_year')).average(:mood_rating)
     anxiety_chart_data = @moods.group_by_month(:timestamp, range: date_range_for('last_year')).average(:anxiety_rating)
     irritability_chart_data = @moods.group_by_month(:timestamp, range: date_range_for('last_year')).average(:irritability_rating)
   end
%>

<div class="col-md-12">
  <%= line_chart [
                         {name: t("shared.chartmood.mood"), data: mood_chart_data}
                 ], colors: [MOOD_PRIMARY_COLOR],
                 library: {
                         title: t("shared.chartmood.mood"),
                         titlePosition: 'out',
                         titleTextStyle: {
                                 color: MOOD_PRIMARY_COLOR
                         },
                         backgroundColor: {
                                 fill: MOOD_BACKGROUND_COLOR,
                                 stroke: MOOD_PRIMARY_COLOR,
                                 strokeWidth: MOOD_STROKE_WIDTH
                         },
                         animation: {
                                 duration: MOOD_ANIMATION_DURATION,
                                 startup: true,
                                 easing: MOOD_ANIMATION_EASING
                         },
                         hAxis: {
                                 textStyle: {
                                         color: MOOD_PRIMARY_COLOR
                                 },
                                 gridlines: {
                                         color: MOOD_BACKGROUND_COLOR
                                 }
                         },
                         legend: {
                                 textStyle: {
                                         color: MOOD_BACKGROUND_COLOR
                                 },
                                 position: MOOD_LEGEND_POSITION
                         },
                         vAxis: {
                                 ticks: [{v: 1, f: t("shared.chartmood.sevd")}, {v: 2, f: t("shared.chartmood.modd")}, {v: 3, f: t("shared.chartmood.mildd")}, {v: 4, f: t("shared.chartmood.base")}, {v: 5, f: t("shared.chartmood.milde")}, {v: 6, f: t("shared.chartmood.mode")}, {v: 7, f: t("shared.chartmood.seve")}],
                                 textStyle: {
                                         color: MOOD_PRIMARY_COLOR
                                 },
                                 gridlines: {
                                         color: MOOD_BACKGROUND_COLOR
                                 }
                         }
                 } %>
</div>

<div class="col-md-12">
  <%= line_chart [
                         {name: t("shared.chartmood.anxiety"), data: anxiety_chart_data}
                 ], colors: [MOOD_PRIMARY_COLOR],
                 library: {
                         title: t("shared.chartmood.anxiety"),
                         titlePosition: 'out',
                         titleTextStyle: {
                                 color: MOOD_PRIMARY_COLOR
                         },
                         backgroundColor: {
                                 fill: MOOD_BACKGROUND_COLOR,
                                 stroke: MOOD_PRIMARY_COLOR,
                                 strokeWidth: MOOD_STROKE_WIDTH
                         },
                         animation: {
                                 duration: MOOD_ANIMATION_DURATION,
                                 startup: true,
                                 easing: MOOD_ANIMATION_EASING
                         },
                         hAxis: {
                                 textStyle: {
                                         color: MOOD_PRIMARY_COLOR
                                 },
                                 gridlines: {
                                         color: MOOD_BACKGROUND_COLOR
                                 }
                         },
                         legend: {
                                 textStyle: {
                                         color: MOOD_PRIMARY_COLOR
                                 },
                                 position: MOOD_LEGEND_POSITION
                         },
                         vAxis: {
                                 ticks: [{v: 1, f: t("shared.chartmood.none")}, {v: 2, f: t("shared.chartmood.mild")}, {v: 3, f: t("shared.chartmood.mod")}, {v: 4, f: t("shared.chartmood.sev")}],
                                 textStyle: {
                                         color: MOOD_PRIMARY_COLOR
                                 },
                                 gridlines: {
                                         color: MOOD_BACKGROUND_COLOR
                                 }
                         }
                 } %>
</div>

<div class="col-md-12">
  <%= line_chart [
                         {name: t("shared.chartmood.irritability"), data: irritability_chart_data}
                 ], colors: [MOOD_PRIMARY_COLOR],
                 library: {
                         title: t("shared.chartmood.irritability"),
                         titlePosition: 'out',
                         titleTextStyle: {
                                 color: MOOD_PRIMARY_COLOR
                         },
                         backgroundColor: {
                                 fill: MOOD_BACKGROUND_COLOR,
                                 stroke: MOOD_PRIMARY_COLOR,
                                 strokeWidth: MOOD_STROKE_WIDTH
                         },
                         animation: {
                                 duration: MOOD_ANIMATION_DURATION,
                                 startup: true,
                                 easing: MOOD_ANIMATION_EASING
                         },
                         hAxis: {
                                 textStyle: {
                                         color: MOOD_PRIMARY_COLOR
                                 },
                                 gridlines: {
                                         color: MOOD_BACKGROUND_COLOR
                                 }
                         },
                         legend: {
                                 textStyle: {
                                         color: MOOD_PRIMARY_COLOR
                                 },
                                 position: MOOD_LEGEND_POSITION
                         },
                         vAxis: {
                                 ticks: [{v: 1, f: t("shared.chartmood.none")}, {v: 2, f: t("shared.chartmood.mild")}, {v: 3, f: t("shared.chartmood.mod")}, {v: 4, f: t("shared.chartmood.sev")}],
                                 textStyle: {
                                         color: MOOD_PRIMARY_COLOR
                                 },
                                 gridlines: {
                                         color: MOOD_BACKGROUND_COLOR
                                 }
                         }
                 } %>
</div>